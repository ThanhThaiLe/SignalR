{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { HttpTransportType, HubConnectionBuilder } from '@microsoft/signalr';\nimport * as i0 from \"@angular/core\";\nexport class ChatService {\n  constructor() {\n    this.messageReceived = new EventEmitter();\n    this.connectionEstablished = new EventEmitter();\n    this.connectionIsEstablished = false;\n    debugger;\n    this.createConnection();\n    this.registerOnServerEvents();\n    this.startConnection();\n  }\n  sendMessage(message) {\n    this._hubConnection.invoke('NewMessage', message);\n  }\n  createConnection() {\n    console.log('window.location.href' + window.location.href);\n    debugger;\n    console.log('create connection hub start');\n    this._hubConnection = new HubConnectionBuilder().withUrl(window.location.href + 'MessageHub', {\n      skipNegotiation: true,\n      transport: HttpTransportType.WebSockets\n    }).build();\n    console.log('create connection hub done');\n  }\n  startConnection() {\n    debugger;\n    this._hubConnection.start().then(() => {\n      this.connectionIsEstablished = true;\n      console.log('Hub connection started');\n      this.connectionEstablished.emit(true);\n    }).catch(() => {\n      console.log('Error while establishing connection, retrying...');\n      setTimeout(() => {\n        this.startConnection();\n      }, 5000);\n    });\n  }\n  registerOnServerEvents() {\n    debugger;\n    this._hubConnection.on('MessageReceived', data => {\n      this.messageReceived.emit(data);\n    });\n  }\n}\nChatService.ɵfac = function ChatService_Factory(t) {\n  return new (t || ChatService)();\n};\nChatService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: ChatService,\n  factory: ChatService.ɵfac\n});","map":{"version":3,"mappings":"AAAA,SAASA,YAAY,QAAoB,eAAe;AAExD,SACEC,iBAAiB,EAEjBC,oBAAoB,QACf,oBAAoB;;AAG3B,OAAM,MAAOC,WAAW;EAOtBC;IANA,oBAAe,GAAG,IAAIJ,YAAY,EAAW;IAC7C,0BAAqB,GAAG,IAAIA,YAAY,EAAW;IAE3C,4BAAuB,GAAG,KAAK;IAIrC;IACA,IAAI,CAACK,gBAAgB,EAAE;IACvB,IAAI,CAACC,sBAAsB,EAAE;IAC7B,IAAI,CAACC,eAAe,EAAE;EACxB;EAEAC,WAAW,CAACC,OAAgB;IAC1B,IAAI,CAACC,cAAc,CAACC,MAAM,CAAC,YAAY,EAAEF,OAAO,CAAC;EACnD;EAEQJ,gBAAgB;IACtBO,OAAO,CAACC,GAAG,CAAC,sBAAsB,GAAGC,MAAM,CAACC,QAAQ,CAACC,IAAI,CAAC;IAC1D;IAEAJ,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAC;IAC1C,IAAI,CAACH,cAAc,GAAG,IAAIR,oBAAoB,EAAE,CAC7Ce,OAAO,CAACH,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,YAAY,EAAE;MAC5CE,eAAe,EAAE,IAAI;MACrBC,SAAS,EAAElB,iBAAiB,CAACmB;KAC9B,CAAC,CACDC,KAAK,EAAE;IACVT,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC;EAC3C;EAEQN,eAAe;IACrB;IAEA,IAAI,CAACG,cAAc,CAChBY,KAAK,EAAE,CACPC,IAAI,CAAC,MAAK;MACT,IAAI,CAACC,uBAAuB,GAAG,IAAI;MACnCZ,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAC;MACrC,IAAI,CAACY,qBAAqB,CAACC,IAAI,CAAC,IAAI,CAAC;IACvC,CAAC,CAAC,CACDC,KAAK,CAAC,MAAK;MACVf,OAAO,CAACC,GAAG,CAAC,kDAAkD,CAAC;MAC/De,UAAU,CAAC,MAAK;QACd,IAAI,CAACrB,eAAe,EAAE;MACxB,CAAC,EAAE,IAAI,CAAC;IACV,CAAC,CAAC;EACN;EAEQD,sBAAsB;IAC5B;IAEA,IAAI,CAACI,cAAc,CAACmB,EAAE,CAAC,iBAAiB,EAAGC,IAAS,IAAI;MACtD,IAAI,CAACC,eAAe,CAACL,IAAI,CAACI,IAAI,CAAC;IACjC,CAAC,CAAC;EACJ;;AAxDW3B,WAAW;mBAAXA,WAAW;AAAA;AAAXA,WAAW;SAAXA,WAAW;EAAA6B,SAAX7B,WAAW;AAAA","names":["EventEmitter","HttpTransportType","HubConnectionBuilder","ChatService","constructor","createConnection","registerOnServerEvents","startConnection","sendMessage","message","_hubConnection","invoke","console","log","window","location","href","withUrl","skipNegotiation","transport","WebSockets","build","start","then","connectionIsEstablished","connectionEstablished","emit","catch","setTimeout","on","data","messageReceived","factory"],"sourceRoot":"","sources":["D:\\Github\\SignalR\\SignalRAngularASP\\SignalRAngular\\ClientApp\\src\\app\\chat.service.ts"],"sourcesContent":["import { EventEmitter, Injectable } from '@angular/core';\r\nimport { Message } from './message.types';\r\nimport {\r\n  HttpTransportType,\r\n  HubConnection,\r\n  HubConnectionBuilder,\r\n} from '@microsoft/signalr';\r\n\r\n@Injectable()\r\nexport class ChatService {\r\n  messageReceived = new EventEmitter<Message>();\r\n  connectionEstablished = new EventEmitter<Boolean>();\r\n\r\n  private connectionIsEstablished = false;\r\n  private _hubConnection: HubConnection;\r\n\r\n  constructor() {\r\n    debugger;\r\n    this.createConnection();\r\n    this.registerOnServerEvents();\r\n    this.startConnection();\r\n  }\r\n\r\n  sendMessage(message: Message) {\r\n    this._hubConnection.invoke('NewMessage', message);\r\n  }\r\n\r\n  private createConnection() {\r\n    console.log('window.location.href' + window.location.href);\r\n    debugger;\r\n\r\n    console.log('create connection hub start');\r\n    this._hubConnection = new HubConnectionBuilder()\r\n      .withUrl(window.location.href + 'MessageHub', {\r\n        skipNegotiation: true,\r\n        transport: HttpTransportType.WebSockets,\r\n      })\r\n      .build();\r\n    console.log('create connection hub done');\r\n  }\r\n\r\n  private startConnection(): void {\r\n    debugger;\r\n\r\n    this._hubConnection\r\n      .start()\r\n      .then(() => {\r\n        this.connectionIsEstablished = true;\r\n        console.log('Hub connection started');\r\n        this.connectionEstablished.emit(true);\r\n      })\r\n      .catch(() => {\r\n        console.log('Error while establishing connection, retrying...');\r\n        setTimeout(() => {\r\n          this.startConnection();\r\n        }, 5000);\r\n      });\r\n  }\r\n\r\n  private registerOnServerEvents(): void {\r\n    debugger;\r\n\r\n    this._hubConnection.on('MessageReceived', (data: any) => {\r\n      this.messageReceived.emit(data);\r\n    });\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}